<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>Footy Predictor</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öΩ</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body x-data="app">

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <nav class="nav">
    <div class="container nav-inner">
      <a class="nav-brand" href="/" @click.prevent="goHome()">‚öΩ Footy Predictor</a>
      <div class="nav-right">
        <template x-if="lastUpdated">
          <span class="last-updated" x-text="'Updated ' + formatUpdated(lastUpdated)"></span>
        </template>
        <div class="nav-tabs" x-show="view === 'main'">
          <button class="nav-tab" :class="{ active: tab === 'matches' }"
                  @click="switchTab('matches')">Matches</button>
          <button class="nav-tab" :class="{ active: tab === 'insights' }"
                  @click="switchTab('insights')">Insights</button>
          <button class="nav-tab" :class="{ active: tab === 'table' }"
                  @click="switchTab('table')">Tables</button>
          <button class="nav-tab" :class="{ active: tab === 'stats' }"
                  @click="switchTab('stats')">Stats</button>
        </div>
        <template x-if="view === 'match'">
          <button class="back-btn" @click="goHome()">‚Üê Back</button>
        </template>
      </div>
    </div>
  </nav>

  <main class="container main-content">

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--                 MAIN VIEW                          -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div x-show="view === 'main'" x-cloak>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MATCHES TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div x-show="tab === 'matches'" class="tab-content" x-cloak>
        <template x-if="loading">
          <div class="loading"><div class="spinner"></div></div>
        </template>

        <template x-if="!loading && matches.length === 0">
          <div class="empty">
            <div class="empty-icon">üì≠</div>
            <p>No upcoming matches</p>
            <p class="text-3" style="margin-top:0.3rem">Run <code class="inline-code">footy go</code> to ingest &amp; predict</p>
          </div>
        </template>

        <template x-if="!loading && matches.length > 0">
          <div>
            <div class="filter-bar">
              <template x-for="lg in leagues" :key="lg">
                <button class="filter-pill" :class="{ active: league === lg }"
                        @click="league = lg"
                        x-text="lg === 'all' ? 'All' : lg"></button>
              </template>
              <span class="filter-count" x-text="filteredMatches.length + ' matches'"></span>
            </div>

            <template x-for="[date, group] in groupedMatches()" :key="date">
              <div>
                <div class="date-header" x-text="formatDate(date)"></div>
                <template x-for="m in group" :key="m.match_id">
                  <a class="glass glass-hover match-card" :href="'/match/' + m.match_id"
                     @click.prevent="openMatch(m.match_id)">
                    <div class="match-top">
                      <div class="match-teams-text">
                        <span class="match-home" x-text="m.home_team"></span>
                        <span class="match-vs">vs</span>
                        <span class="match-away" x-text="m.away_team"></span>
                      </div>
                      <div class="match-meta">
                        <span class="match-time" x-text="matchTime(m)"></span>
                        <span :class="badgeClass(m.competition)" x-text="m.competition"></span>
                      </div>
                    </div>

                    <template x-if="m.p_home != null">
                      <div class="prob-section">
                        <div class="prob-bar">
                          <div class="home" :style="'width:' + (m.p_home*100) + '%'"></div>
                          <div class="draw" :style="'width:' + (m.p_draw*100) + '%'"></div>
                          <div class="away" :style="'width:' + (m.p_away*100) + '%'"></div>
                        </div>
                        <div class="prob-labels">
                          <div class="prob-label"><span class="prob-dot home"></span><span class="prob-pct" x-text="pct(m.p_home)"></span></div>
                          <div class="prob-label"><span class="prob-dot draw"></span><span class="prob-pct" x-text="pct(m.p_draw)"></span></div>
                          <div class="prob-label"><span class="prob-dot away"></span><span class="prob-pct" x-text="pct(m.p_away)"></span></div>
                        </div>
                        <div class="card-footer">
                          <div class="verdict" :class="verdict(m).cls" x-text="verdict(m).text"></div>
                          <template x-if="confidence(m)">
                            <span class="conf-badge" :class="'conf-' + confidence(m)">
                              <span class="conf-dot"></span>
                              <span x-text="confLabel(m)"></span>
                            </span>
                          </template>
                        </div>
                      </div>
                    </template>

                    <template x-if="m.p_home == null">
                      <p class="text-3" style="font-size:0.78rem; margin-top:0.3rem;">No prediction yet</p>
                    </template>
                  </a>
                </template>
              </div>
            </template>
          </div>
        </template>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INSIGHTS TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div x-show="tab === 'insights'" class="tab-content" x-cloak>
        <div class="insights-header">
          <h2 class="section-title">üí∞ Value Bets</h2>
          <span class="text-3" x-text="valueBets.length + ' opportunities'"></span>
        </div>

        <template x-if="loadingBets">
          <div class="loading"><div class="spinner"></div></div>
        </template>

        <template x-if="!loadingBets && valueBets.length === 0">
          <div class="empty">
            <div class="empty-icon">üîç</div>
            <p>No value bets found</p>
            <p class="text-3" style="margin-top:0.3rem">No edges detected at current threshold</p>
          </div>
        </template>

        <template x-for="b in valueBets" :key="b.match_id + b.bet">
          <div class="glass bet-card">
            <div class="bet-left">
              <div class="bet-match" x-text="b.home_team + ' vs ' + b.away_team"></div>
              <div class="bet-meta">
                <span :class="badgeClass(b.competition)" x-text="b.competition"></span>
                <span x-text="b.date"></span>
                <span class="bet-type" :class="b.bet" x-text="b.bet"></span>
                <span>Model: <strong x-text="pct(b.model_prob)"></strong></span>
              </div>
              <div class="bet-kelly" x-text="'Kelly stake: ' + kellyPct(b.model_prob, b.odds)"></div>
            </div>
            <div class="bet-right">
              <div class="bet-odds" x-text="b.odds.toFixed(2)"></div>
              <div class="bet-edge-tag" x-text="'+' + (b.edge * 100).toFixed(1) + '%'"></div>
            </div>
          </div>
        </template>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LEAGUE TABLE TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div x-show="tab === 'table'" class="tab-content" x-cloak>
        <div class="table-header">
          <h2 class="section-title">üèÜ League Tables</h2>
          <div class="table-comp-pills">
            <template x-for="c in tableCompetitions" :key="c">
              <button class="filter-pill" :class="{ active: tableComp === c }"
                      @click="selectTableComp(c)" x-text="c"></button>
            </template>
          </div>
        </div>

        <template x-if="loadingTable">
          <div class="loading"><div class="spinner"></div></div>
        </template>

        <template x-if="!loadingTable && leagueTable.length > 0">
          <div class="glass standings-table">
            <div class="standings-head">
              <span class="st-pos">#</span>
              <span class="st-team">Team</span>
              <span class="st-stat">P</span>
              <span class="st-stat">W</span>
              <span class="st-stat">D</span>
              <span class="st-stat">L</span>
              <span class="st-stat st-gd">GD</span>
              <span class="st-pts">Pts</span>
            </div>
            <template x-for="(r, i) in leagueTable" :key="r.team">
              <div class="standings-row" :class="{ 'st-top': i < 4, 'st-bottom': i >= leagueTable.length - 3 }">
                <span class="st-pos" x-text="r.pos"></span>
                <span class="st-team" x-text="r.team"></span>
                <span class="st-stat" x-text="r.p"></span>
                <span class="st-stat" x-text="r.w"></span>
                <span class="st-stat" x-text="r.d"></span>
                <span class="st-stat" x-text="r.l"></span>
                <span class="st-stat st-gd" :class="r.gd > 0 ? 'gd-pos' : r.gd < 0 ? 'gd-neg' : ''" x-text="r.gd > 0 ? '+' + r.gd : r.gd"></span>
                <span class="st-pts" x-text="r.pts"></span>
              </div>
            </template>
          </div>
        </template>

        <template x-if="!loadingTable && leagueTable.length === 0">
          <div class="empty">
            <div class="empty-icon">üìä</div>
            <p>No standings data</p>
          </div>
        </template>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê STATS TAB ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div x-show="tab === 'stats'" class="tab-content" x-cloak>

        <!-- Performance Section -->
        <h2 class="section-title" style="margin-bottom: 1rem;">üìà Model Performance</h2>

        <template x-if="loadingPerf && !performance">
          <div class="loading" style="padding:1.5rem 0"><div class="spinner"></div></div>
        </template>

        <template x-if="performance">
          <div style="margin-bottom: 2rem;">
            <template x-if="performance.metrics">
              <div class="perf-grid" style="margin-bottom: 1rem;">
                <div class="stat-card glass perf-card">
                  <div class="stat-val" :style="'color:' + perfAccuracyColor(performance.metrics.accuracy)"
                       x-text="performance.metrics.accuracy != null ? (performance.metrics.accuracy * 100).toFixed(1) + '%' : '‚Äî'"></div>
                  <div class="stat-label">Accuracy</div>
                </div>
                <div class="stat-card glass perf-card">
                  <div class="stat-val" x-text="performance.metrics.logloss?.toFixed(3) || '‚Äî'"></div>
                  <div class="stat-label">Log Loss</div>
                  <div class="stat-grade" x-text="loglossGrade(performance.metrics.logloss)"></div>
                </div>
                <div class="stat-card glass perf-card">
                  <div class="stat-val" x-text="performance.metrics.brier?.toFixed(3) || '‚Äî'"></div>
                  <div class="stat-label">Brier Score</div>
                </div>
                <div class="stat-card glass perf-card">
                  <div class="stat-val" x-text="performance.metrics.n_scored || 0"></div>
                  <div class="stat-label">Scored</div>
                </div>
              </div>
            </template>

            <template x-if="!performance.metrics">
              <div class="glass info-box">
                No scored predictions yet. Run <code class="inline-code">footy go</code> after matches finish to score.
              </div>
            </template>

            <!-- Calibration Chart -->
            <template x-if="performance.calibration?.length > 0">
              <div style="margin-bottom: 1.25rem;">
                <div class="section-label"><span class="icon">üéØ</span> Calibration</div>
                <div class="glass calibration-chart">
                  <div class="cal-grid">
                    <template x-for="b in performance.calibration" :key="b.bucket">
                      <div class="cal-bar-wrap">
                        <div class="cal-bar">
                          <div class="cal-predicted" :style="'height:' + (b.avg_predicted * 100) + '%'" :title="'Predicted: ' + pct(b.avg_predicted)"></div>
                          <div class="cal-actual" :style="'height:' + (b.avg_actual * 100) + '%'" :title="'Actual: ' + pct(b.avg_actual)"></div>
                        </div>
                        <div class="cal-label" x-text="b.bucket"></div>
                        <div class="cal-count" x-text="b.count"></div>
                      </div>
                    </template>
                  </div>
                  <div class="cal-legend">
                    <span><span class="cal-dot predicted"></span> Predicted</span>
                    <span><span class="cal-dot actual"></span> Actual</span>
                  </div>
                </div>
              </div>
            </template>

            <!-- Accuracy by competition -->
            <template x-if="performance.by_competition?.length > 0">
              <div>
                <div class="section-label"><span class="icon">üèÜ</span> Accuracy by League</div>
                <template x-for="c in performance.by_competition" :key="c.competition">
                  <div class="comp-row" style="position:relative; overflow:hidden;">
                    <div class="comp-fill" :style="'width:' + (c.accuracy*100) + '%; background:' + perfAccuracyColor(c.accuracy)"></div>
                    <div class="comp-content">
                      <div style="display:flex; align-items:center; gap:0.5rem;">
                        <span :class="badgeClass(c.competition)" x-text="c.competition"></span>
                        <span class="comp-code" x-text="leagueName(c.competition)"></span>
                      </div>
                      <div style="display:flex; align-items:center; gap:0.75rem;">
                        <span class="mono text-3" style="font-size:0.72rem;" x-text="c.n + ' matches'"></span>
                        <span class="mono" style="font-weight:700; font-size:0.85rem;" :style="'color:' + perfAccuracyColor(c.accuracy)" x-text="(c.accuracy * 100).toFixed(0) + '%'"></span>
                      </div>
                    </div>
                  </div>
                </template>
              </div>
            </template>

            <!-- Recent scored -->
            <template x-if="performance.recent?.length > 0">
              <div style="margin-top: 1.25rem;">
                <div class="section-label"><span class="icon">üìã</span> Recent Results</div>
                <div class="glass" style="padding: 0.5rem 0.75rem;">
                  <template x-for="s in performance.recent.slice(0, 15)" :key="s.date + s.home_team">
                    <div class="scored-row">
                      <span class="scored-result" :class="s.correct ? 'correct' : 'wrong'" x-text="s.correct ? '‚úì' : '‚úó'"></span>
                      <div class="scored-info">
                        <span class="scored-teams" x-text="s.home_team + ' ' + s.home_goals + '-' + s.away_goals + ' ' + s.away_team"></span>
                        <span class="scored-meta"><span x-text="s.outcome"></span> ¬∑ <span x-text="'We said ' + pct(s.outcome === 'Home' ? s.p_home : s.outcome === 'Draw' ? s.p_draw : s.p_away)"></span></span>
                      </div>
                      <span class="scored-date" x-text="s.date"></span>
                    </div>
                  </template>
                </div>
              </div>
            </template>
          </div>
        </template>

        <!-- Database Section -->
        <h2 class="section-title" style="margin-bottom: 1rem;">üìä Database</h2>

        <template x-if="loadingStats && !stats">
          <div class="loading"><div class="spinner"></div></div>
        </template>

        <template x-if="stats">
          <div>
            <div class="stats-grid" style="margin-bottom: 1.5rem;">
              <div class="stat-card glass"><div class="stat-val" x-text="stats.total_matches?.toLocaleString()"></div><div class="stat-label">Total Matches</div></div>
              <div class="stat-card glass"><div class="stat-val" x-text="stats.finished?.toLocaleString()"></div><div class="stat-label">Finished</div></div>
              <div class="stat-card glass"><div class="stat-val" x-text="stats.upcoming"></div><div class="stat-label">Upcoming</div></div>
              <div class="stat-card glass"><div class="stat-val" x-text="stats.teams"></div><div class="stat-label">Teams</div></div>
              <div class="stat-card glass"><div class="stat-val" x-text="stats.predictions?.toLocaleString()"></div><div class="stat-label">Predictions</div></div>
              <div class="stat-card glass"><div class="stat-val" x-text="stats.h2h_pairs || '‚Äî'"></div><div class="stat-label">H2H Pairs</div></div>
            </div>

            <div class="section-label"><span class="icon">üèÜ</span> Competitions</div>
            <template x-for="c in stats.competitions" :key="c.code">
              <div class="comp-row">
                <div class="comp-content">
                  <div style="display:flex; align-items:center; gap:0.5rem;">
                    <span :class="badgeClass(c.code)" x-text="c.code"></span>
                    <span class="comp-code" x-text="leagueName(c.code)"></span>
                  </div>
                  <span class="comp-count" x-text="c.count.toLocaleString()"></span>
                </div>
              </div>
            </template>

            <div class="section-label" style="margin-top:1.25rem;"><span class="icon">ü§ñ</span> Models</div>
            <template x-for="m in stats.models" :key="m.version">
              <div class="model-row">
                <span class="model-ver" :class="{ current: m.version === 'v10_council' }" x-text="m.version"></span>
                <span class="model-count" x-text="m.predictions + ' predictions'"></span>
              </div>
            </template>
          </div>
        </template>
      </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <!--               MATCH DETAIL VIEW                    -->
    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div x-show="view === 'match'" class="tab-content match-detail-view" x-cloak>

      <template x-if="loadingDetail">
        <div class="loading" style="padding:3rem 0"><div class="spinner"></div></div>
      </template>

      <template x-if="md && !loadingDetail">
        <div>
          <!-- ‚îÄ‚îÄ Hero Section ‚îÄ‚îÄ -->
          <div class="match-hero glass">
            <div class="hero-competition">
              <span :class="badgeClass(md.competition)" x-text="md.competition"></span>
              <span class="text-3" x-text="leagueName(md.competition)"></span>
              <span class="text-3">¬∑</span>
              <span class="text-3" x-text="md.utc_date?.slice(0,10)"></span>
              <template x-if="matchTime(md)">
                <span class="text-3" x-text="matchTime(md)"></span>
              </template>
            </div>

            <div class="hero-teams">
              <div class="hero-team">
                <div class="hero-team-name" x-text="md.home_team"></div>
                <div class="hero-team-tag">HOME</div>
              </div>
              <div class="hero-vs-block">
                <template x-if="md.status === 'FINISHED' && md.home_goals != null">
                  <div class="hero-score">
                    <span x-text="md.home_goals"></span>
                    <span class="hero-dash">‚Äì</span>
                    <span x-text="md.away_goals"></span>
                  </div>
                </template>
                <template x-if="md.status !== 'FINISHED'">
                  <div class="hero-vs">VS</div>
                </template>
              </div>
              <div class="hero-team">
                <div class="hero-team-name" x-text="md.away_team"></div>
                <div class="hero-team-tag">AWAY</div>
              </div>
            </div>

            <!-- Prediction Score Banner -->
            <template x-if="md.score">
              <div class="score-result-banner" :class="md.score.correct ? 'correct' : 'wrong'">
                <span class="score-icon" x-text="md.score.correct ? '‚úì' : '‚úó'"></span>
                <div>
                  <div class="score-result-text" x-text="md.score.correct ? 'Prediction correct!' : 'Prediction incorrect'"></div>
                  <div class="score-result-detail"><span x-text="'Result: ' + md.score.outcome"></span> ¬∑ <span x-text="'LogLoss: ' + md.score.logloss.toFixed(3)"></span></div>
                </div>
              </div>
            </template>

            <!-- Hero Probabilities -->
            <template x-if="md.prediction">
              <div class="hero-probs">
                <div class="hero-prob home" :class="{ highest: isHighest('home') }">
                  <div class="pct" x-text="pct(md.prediction.p_home)"></div>
                  <div class="lbl">Home Win</div>
                </div>
                <div class="hero-prob draw" :class="{ highest: isHighest('draw') }">
                  <div class="pct" x-text="pct(md.prediction.p_draw)"></div>
                  <div class="lbl">Draw</div>
                </div>
                <div class="hero-prob away" :class="{ highest: isHighest('away') }">
                  <div class="pct" x-text="pct(md.prediction.p_away)"></div>
                  <div class="lbl">Away Win</div>
                </div>
              </div>
            </template>

            <!-- xG -->
            <template x-if="md.prediction?.eg_home != null">
              <div class="xg-row">
                <div><div class="xg-val" x-text="md.prediction.eg_home"></div><div class="xg-lbl">xG Home</div></div>
                <div><div class="xg-val" x-text="md.prediction.eg_away"></div><div class="xg-lbl">xG Away</div></div>
              </div>
            </template>
          </div>

          <!-- ‚îÄ‚îÄ Detail Grid (2-column on desktop) ‚îÄ‚îÄ -->
          <div class="detail-grid">

            <!-- Left column -->
            <div class="detail-col">

              <!-- Poisson Analysis -->
              <template x-if="md.poisson">
                <div class="section">
                  <div class="section-label"><span class="icon">üéØ</span> Poisson Analysis</div>
                  <div class="glass poisson-grid">
                    <div class="poisson-cell">
                      <div class="poisson-val" x-text="Array.isArray(md.poisson.predicted_score) ? md.poisson.predicted_score.join(' - ') : (md.poisson.predicted_score || '‚Äî')"></div>
                      <div class="poisson-lbl">Predicted Score</div>
                    </div>
                    <div class="poisson-cell">
                      <div class="poisson-val" :class="md.poisson.btts >= 0.5 ? 'poisson-yes' : 'poisson-no'" x-text="pct(md.poisson.btts)"></div>
                      <div class="poisson-lbl">BTTS</div>
                    </div>
                    <div class="poisson-cell">
                      <div class="poisson-val" :class="md.poisson.o25 >= 0.5 ? 'poisson-yes' : 'poisson-no'" x-text="pct(md.poisson.o25)"></div>
                      <div class="poisson-lbl">Over 2.5</div>
                    </div>
                  </div>
                  <div class="poisson-lambda text-3" style="margin-top:0.4rem;">
                    <span x-text="'Œª Home: ' + (md.poisson.lambda_home?.toFixed(2) || '‚Äî')"></span> ¬∑
                    <span x-text="'Œª Away: ' + (md.poisson.lambda_away?.toFixed(2) || '‚Äî')"></span>
                  </div>

                  <!-- v10: Dixon-Coles adjusted probabilities -->
                  <template x-if="md.poisson.dc_home != null">
                    <div style="margin-top:0.6rem; border-top: 1px solid rgba(255,255,255,0.08); padding-top:0.5rem;">
                      <div class="text-3" style="color:var(--text-2); margin-bottom:0.3rem; font-weight:600;">Dixon-Coles Adjusted</div>
                      <div class="poisson-grid" style="gap:0.5rem;">
                        <div class="poisson-cell">
                          <div class="poisson-val text-2" x-text="pct(md.poisson.dc_home)"></div>
                          <div class="poisson-lbl">DC Home</div>
                        </div>
                        <div class="poisson-cell">
                          <div class="poisson-val text-2" x-text="pct(md.poisson.dc_draw)"></div>
                          <div class="poisson-lbl">DC Draw</div>
                        </div>
                        <div class="poisson-cell">
                          <div class="poisson-val text-2" x-text="pct(md.poisson.dc_away)"></div>
                          <div class="poisson-lbl">DC Away</div>
                        </div>
                      </div>
                    </div>
                  </template>

                  <!-- v10: Monte Carlo simulation -->
                  <template x-if="md.poisson.mc_btts != null">
                    <div style="margin-top:0.4rem; border-top: 1px solid rgba(255,255,255,0.08); padding-top:0.5rem;">
                      <div class="text-3" style="color:var(--text-2); margin-bottom:0.3rem; font-weight:600;">Monte Carlo (2000 sims)</div>
                      <div class="poisson-grid" style="gap:0.5rem;">
                        <div class="poisson-cell">
                          <div class="poisson-val text-2" :class="md.poisson.mc_btts >= 0.5 ? 'poisson-yes' : 'poisson-no'" x-text="pct(md.poisson.mc_btts)"></div>
                          <div class="poisson-lbl">MC BTTS</div>
                        </div>
                        <div class="poisson-cell">
                          <div class="poisson-val text-2" :class="md.poisson.mc_o25 >= 0.5 ? 'poisson-yes' : 'poisson-no'" x-text="pct(md.poisson.mc_o25)"></div>
                          <div class="poisson-lbl">MC O2.5</div>
                        </div>
                      </div>
                    </div>
                  </template>
                </div>
              </template>

              <!-- Form Streaks -->
              <template x-if="matchForm?.home_form || matchForm?.away_form">
                <div class="section">
                  <div class="section-label"><span class="icon">üìà</span> Recent Form</div>
                  <div class="glass" style="padding: 0.75rem 1rem;">
                    <template x-if="matchForm?.home_form">
                      <div style="margin-bottom:0.5rem; display:flex; align-items:center; gap:0.5rem;">
                        <span class="form-label" x-text="md.home_team"></span>
                        <div class="form-streak">
                          <template x-for="(r, i) in matchForm.home_form" :key="'hf'+i">
                            <div class="form-dot" :class="r" x-text="r"></div>
                          </template>
                        </div>
                        <span class="text-3 mono" x-text="matchForm.home_ppg != null ? matchForm.home_ppg.toFixed(1) + ' ppg' : ''"></span>
                      </div>
                    </template>
                    <template x-if="matchForm?.away_form">
                      <div style="display:flex; align-items:center; gap:0.5rem;">
                        <span class="form-label" x-text="md.away_team"></span>
                        <div class="form-streak">
                          <template x-for="(r, i) in matchForm.away_form" :key="'af'+i">
                            <div class="form-dot" :class="r" x-text="r"></div>
                          </template>
                        </div>
                        <span class="text-3 mono" x-text="matchForm.away_ppg != null ? matchForm.away_ppg.toFixed(1) + ' ppg' : ''"></span>
                      </div>
                    </template>
                  </div>
                </div>
              </template>

              <!-- Market Odds -->
              <template x-if="md.odds">
                <div class="section">
                  <div class="section-label"><span class="icon">üìä</span> Market Odds</div>
                  <div class="glass" style="padding: 0.75rem 1rem;">
                    <div class="odds-grid">
                      <template x-for="o in [{lbl:'HOME',val:md.odds.b365h,impl:md.odds.implied_h,mp:md.prediction?.p_home},{lbl:'DRAW',val:md.odds.b365d,impl:md.odds.implied_d,mp:md.prediction?.p_draw},{lbl:'AWAY',val:md.odds.b365a,impl:md.odds.implied_a,mp:md.prediction?.p_away}]" :key="o.lbl">
                        <div class="odds-cell">
                          <div class="odds-val" x-text="o.val"></div>
                          <div class="odds-lbl" x-text="o.lbl"></div>
                          <div class="odds-implied" x-text="pct(o.impl)"></div>
                          <template x-if="o.mp != null">
                            <div :class="edge(o.mp, o.val) > 0 ? 'edge-pos' : 'edge-neg'" style="font-size:0.65rem; margin-top:0.15rem; font-family:var(--mono);" x-text="edgeText(o.mp, o.val)"></div>
                          </template>
                        </div>
                      </template>
                    </div>
                    <div class="text-3" style="text-align:center" x-text="'Overround: ' + pct1(md.odds.overround)"></div>
                  </div>
                </div>
              </template>

              <!-- Elo -->
              <template x-if="md.elo">
                <div class="section">
                  <div class="section-label"><span class="icon">üìê</span> Elo Ratings</div>
                  <div class="glass" style="padding: 0.75rem 1rem;">
                    <div class="elo-grid">
                      <div><div class="elo-val" x-text="md.elo.home || '‚Äî'"></div><div class="elo-lbl" x-text="md.home_team"></div></div>
                      <div class="elo-diff" :class="{'elo-diff-pos': md.elo.diff > 0, 'elo-diff-neg': md.elo.diff < 0, 'elo-diff-neu': !md.elo.diff}">
                        <span x-text="md.elo.diff != null ? (md.elo.diff > 0 ? '+' : '') + Math.round(md.elo.diff) : '‚Äî'"></span>
                        <span class="elo-lbl">Diff</span>
                      </div>
                      <div><div class="elo-val" x-text="md.elo.away || '‚Äî'"></div><div class="elo-lbl" x-text="md.away_team"></div></div>
                    </div>
                  </div>
                </div>
              </template>

              <!-- xG Analysis -->
              <template x-if="matchXG && matchXG.home_xg != null">
                <div class="section">
                  <div class="section-label"><span class="icon">‚ö°</span> Expected Goals (xG)</div>
                  <div class="glass" style="padding: 0.75rem 1rem;">
                    <div class="elo-grid">
                      <div><div class="elo-val" x-text="matchXG.home_xg?.toFixed(2) || '‚Äî'"></div><div class="elo-lbl" x-text="md.home_team"></div></div>
                      <div style="text-align:center">
                        <div class="text-3" style="color:var(--text-2);">xG</div>
                        <div class="text-4" x-text="matchXG.method || 'model'" style="color:var(--text-3);"></div>
                      </div>
                      <div><div class="elo-val" x-text="matchXG.away_xg?.toFixed(2) || '‚Äî'"></div><div class="elo-lbl" x-text="md.away_team"></div></div>
                    </div>
                  </div>
                </div>
              </template>

              <!-- Goal Patterns -->
              <template x-if="matchPatterns && (matchPatterns.home || matchPatterns.away)">
                <div class="section">
                  <div class="section-label"><span class="icon">üìà</span> Goal Patterns</div>
                  <div class="glass" style="padding: 0.75rem 1rem;">
                    <template x-for="[side, team, data] in [[matchPatterns.home, md.home_team, matchPatterns.home], [matchPatterns.away, md.away_team, matchPatterns.away]].filter(x => x[0])" :key="team">
                      <div style="margin-bottom:0.5rem;">
                        <div class="text-3" style="font-weight:600; color:var(--text-2); margin-bottom:0.3rem;" x-text="team"></div>
                        <div class="poisson-grid" style="gap:0.4rem;">
                          <div class="poisson-cell" style="padding:0.3rem;">
                            <div class="poisson-val text-3" x-text="pct(data.first_goal_rate)"></div>
                            <div class="poisson-lbl" style="font-size:0.55rem;">Score 1st</div>
                          </div>
                          <div class="poisson-cell" style="padding:0.3rem;">
                            <div class="poisson-val text-3" x-text="pct(data.comeback_rate)"></div>
                            <div class="poisson-lbl" style="font-size:0.55rem;">Comeback</div>
                          </div>
                          <div class="poisson-cell" style="padding:0.3rem;">
                            <div class="poisson-val text-3" x-text="pct(data.btts_rate)"></div>
                            <div class="poisson-lbl" style="font-size:0.55rem;">BTTS</div>
                          </div>
                          <div class="poisson-cell" style="padding:0.3rem;">
                            <div class="poisson-val text-3" x-text="data.avg_goals_scored?.toFixed(1) || '‚Äî'"></div>
                            <div class="poisson-lbl" style="font-size:0.55rem;">Avg GF</div>
                          </div>
                        </div>
                      </div>
                    </template>
                  </div>
                </div>
              </template>
            </div>

            <!-- Right column -->
            <div class="detail-col">

              <!-- Expert Council -->
              <div class="section">
                <div class="section-label"><span class="icon">üß†</span> Expert Council</div>
                <template x-if="loadingExperts">
                  <div class="loading" style="padding:1.5rem 0"><div class="spinner"></div></div>
                </template>
                <template x-if="matchExperts?.experts">
                  <div class="glass" style="padding: 0.6rem;">
                    <div class="expert-grid">
                      <template x-for="[name, data] in Object.entries(matchExperts.experts)" :key="name">
                        <div class="expert-row">
                          <div class="expert-name" x-text="name"></div>
                          <div>
                            <div class="expert-bar">
                              <div class="home" :style="'width:' + (data.probs.home*100) + '%'"></div>
                              <div class="draw" :style="'width:' + (data.probs.draw*100) + '%'"></div>
                              <div class="away" :style="'width:' + (data.probs.away*100) + '%'"></div>
                            </div>
                            <div class="expert-pcts">
                              <span x-text="pct(data.probs.home)"></span>
                              <span x-text="pct(data.probs.draw)"></span>
                              <span x-text="pct(data.probs.away)"></span>
                            </div>
                          </div>
                          <div class="expert-conf" x-text="pct(data.confidence)"></div>
                        </div>
                      </template>
                    </div>
                    <div class="consensus-bar">
                      <div class="consensus-meter">
                        <div class="consensus-fill" :class="consensusClass(matchExperts)" :style="'width:' + consensusScore(matchExperts) + '%'"></div>
                      </div>
                      <span class="consensus-label" x-text="consensusLabel(matchExperts)"></span>
                    </div>
                  </div>
                </template>
                <template x-if="!matchExperts && !loadingExperts">
                  <div class="glass info-box">Loading expert analysis...</div>
                </template>
              </div>

              <!-- H2H -->
              <div class="section">
                <div class="section-label"><span class="icon">‚öîÔ∏è</span> Head-to-Head</div>
                <template x-if="loadingH2H">
                  <div class="loading" style="padding:1.5rem 0"><div class="spinner"></div></div>
                </template>
                <template x-if="matchH2H">
                  <div>
                    <template x-if="matchH2H.stats">
                      <div class="glass" style="padding: 0.75rem 1rem; margin-bottom: 0.5rem;">
                        <div class="h2h-hero">
                          <div>
                            <div class="h2h-team-name" x-text="matchH2H.stats.team_a"></div>
                            <div class="h2h-team-wins" style="color:var(--green)" x-text="matchH2H.stats.team_a_wins"></div>
                          </div>
                          <div class="h2h-center">
                            <div class="h2h-draws" x-text="matchH2H.stats.draws"></div>
                            <div class="h2h-played" x-text="matchH2H.stats.total_matches + ' played'"></div>
                          </div>
                          <div>
                            <div class="h2h-team-name" x-text="matchH2H.stats.team_b"></div>
                            <div class="h2h-team-wins" style="color:var(--red)" x-text="matchH2H.stats.team_b_wins"></div>
                          </div>
                        </div>
                      </div>
                    </template>
                    <template x-if="!matchH2H.stats">
                      <div class="empty" style="padding: 1.5rem;"><p class="text-3">No H2H records found</p></div>
                    </template>
                    <template x-if="matchH2H.recent_matches?.length > 0">
                      <div class="glass" style="padding: 0.6rem 0.85rem;">
                        <template x-for="m in matchH2H.recent_matches" :key="m.utc_date + m.home_team">
                          <div class="h2h-match-row">
                            <span class="h2h-date" x-text="m.utc_date"></span>
                            <span class="h2h-team h2h-team-left" :class="{ 'h2h-winner': winner(m.home_goals, m.away_goals)==='home' }" x-text="m.home_team"></span>
                            <span class="h2h-score" x-text="m.home_goals + '-' + m.away_goals"></span>
                            <span class="h2h-team" :class="{ 'h2h-winner': winner(m.home_goals, m.away_goals)==='away' }" x-text="m.away_team"></span>
                          </div>
                        </template>
                      </div>
                    </template>
                  </div>
                </template>
              </div>

              <!-- AI Narrative -->
              <div class="section">
                <div class="section-label"><span class="icon">‚ú¶</span> AI Analysis</div>
                <template x-if="!matchNarrative && !loadingAI">
                  <button class="action-btn" @click="loadAI()">Generate AI narrative <span class="arrow">‚Üí</span></button>
                </template>
                <template x-if="loadingAI">
                  <div class="loading" style="padding:1.5rem 0"><div class="spinner"></div></div>
                </template>
                <template x-if="matchNarrative">
                  <div class="ai-narrative" x-text="matchNarrative"></div>
                </template>
              </div>

            </div>
          </div>
        </div>
      </template>
    </div>

  </main>

  <!-- Alpine.js -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.3/dist/cdn.min.js"></script>
  <script src="/static/app.js"></script>

</body>
</html>
